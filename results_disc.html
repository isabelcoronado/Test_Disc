<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Resultados - Test DISC</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/emailjs-com@3/dist/email.min.js"></script>
  <style>
    :root {
      --rojo: #e63946;
      --amarillo: #ffbe0b;
      --verde: #06d6a0;
      --azul: #118ab2;
      --gris-fondo: #f6f7fb;
      --blanco: #ffffff;
      --gris-texto: #333;
    }

    body {
      font-family: 'Segoe UI', sans-serif;
      background: var(--gris-fondo);
      margin: 0;
      color: var(--gris-texto);
    }

    .navbar {
      background: var(--azul);
      color: white;
      padding: 15px;
      text-align: center;
      font-size: 26px;
      font-weight: bold;
    }

    .container {
      max-width: 800px;
      margin: 40px auto;
      background: var(--blanco);
      padding: 30px;
      border-radius: 12px;
      box-shadow: 0 6px 20px rgba(0,0,0,0.1);
      text-align: center;
    }

    h2 {
      color: var(--azul);
      margin-bottom: 20px;
    }

    canvas {
      margin: 30px auto;
      max-width: 600px;
      background: #fafafa;
      border-radius: 8px;
      padding: 10px;
    }

    .perfil {
      margin-top: 30px;
      text-align: left;
      background: #f9f9f9;
      padding: 15px;
      border-radius: 8px;
    }

    .perfil h3 {
      color: var(--azul);
    }

    #btnEnviar {
      margin-top: 25px;
      background: var(--amarillo);
      border: none;
      padding: 12px 25px;
      border-radius: 8px;
      font-size: 1.1em;
      font-weight: bold;
      cursor: pointer;
      box-shadow: 0 4px 10px rgba(0,0,0,0.2);
      transition: background-color 0.3s ease;
    }

    #btnEnviar:hover {
      background: #ffb703;
    }
  </style>
</head>
<body>

  <div class="navbar">Resultados del Test DISC</div>

  <div class="container">
    <h2 id="nombreUsuario"></h2>
    <p>Estos son tus resultados en los cuatro factores del modelo DISC:</p>

    <canvas id="graficoDisc"></canvas>

    <div class="perfil">
      <h3>Tu Perfil DISC:</h3>
      <p id="interpretacion"></p>
    </div>

    <button id="btnEnviar">Guardar y Enviar Resultados</button>
  </div>

  <script>
    // Inicializar EmailJS
    emailjs.init("CqmPR984rH-Xseo1l");

    // Recuperar nombre del usuario
    const nombre = localStorage.getItem('userName') || 'Participante';
    document.getElementById('nombreUsuario').textContent = `Hola, ${nombre}`;

    // Recuperar resultados DISC
    const datos = JSON.parse(localStorage.getItem('resultadoDISC')) || {D:0, I:0, S:0, C:0};
    const labels = ['D - Dominancia', 'I - Influencia', 'S - Estabilidad', 'C - Cumplimiento'];
    const valores = [datos.D, datos.I, datos.S, datos.C];
    const colores = ['#e63946', '#ffbe0b', '#06d6a0', '#118ab2'];

    // Crear gráfica
    new Chart(document.getElementById('graficoDisc'), {
      type: 'bar',
      data: {
        labels: labels,
        datasets: [{
          label: 'Puntuación DISC',
          data: valores,
          backgroundColor: colores
        }]
      },
      options: {
        responsive: true,
        scales: {
          y: {
            beginAtZero: true,
            title: { display: true, text: 'Puntos' }
          }
        },
        plugins: {
          legend: { display: false },
          title: { display: true, text: 'Resultados de tu perfil DISC' }
        }
      }
    });

    // Interpretación según el factor más alto
    const maxFactor = Object.keys(datos).reduce((a, b) => datos[a] > datos[b] ? a : b);
    let interpretacion = '';

    switch(maxFactor) {
      case 'D':
        interpretacion = `
          <strong>Dominancia (D)</strong><br>
          Tiendes a ser una persona decidida, orientada a resultados y segura.
          Te gusta liderar, asumir retos y tomar decisiones rápidas.
          En ocasiones puedes parecer directo o impaciente.
        `;
        break;
      case 'I':
        interpretacion = `
          <strong>Influencia (I)</strong><br>
          Eres comunicativo, entusiasta y persuasivo.
          Disfrutas trabajar con otras personas, motivar y generar buen ambiente.
          En algunos momentos puedes perder foco en los detalles.
        `;
        break;
      case 'S':
        interpretacion = `
          <strong>Estabilidad (S)</strong><br>
          Eres paciente, constante y empático.
          Buscas armonía y estabilidad en tu entorno, y valoras las relaciones sólidas.
          A veces puedes resistirte a los cambios rápidos.
        `;
        break;
      case 'C':
        interpretacion = `
          <strong>Cumplimiento (C)</strong><br>
          Eres analítico, preciso y cuidadoso con los detalles.
          Te gusta seguir normas y trabajar con estructura.
          En ocasiones puedes ser muy exigente contigo o con los demás.
        `;
        break;
      default:
        interpretacion = "No se ha podido determinar tu perfil principal.";
    }

    document.getElementById('interpretacion').innerHTML = interpretacion;

    // Enviar resultados por correo al hacer clic
    document.getElementById('btnEnviar').addEventListener('click', () => {
      const correoUsuario = localStorage.getItem('correoUsuario');
      const nombreUsuario = localStorage.getItem('userName') || "Usuario";

      if (!correoUsuario) {
        alert("⚠️ No se encontró un correo guardado. Regresa al inicio e ingrésalo antes de continuar.");
        return;
      }

      const resumen = `
Resultados del Test DISC

Dominancia (D): ${datos.D}
Influencia (I): ${datos.I}
Estabilidad (S): ${datos.S}
Cumplimiento (C): ${datos.C}

Perfil principal: ${maxFactor}
Interpretación:
${interpretacion.replace(/<[^>]*>/g, '')}
      `;

      emailjs.send('Test_Discdm', 'template_Discdm', {
        user_email: correoUsuario,
        user_name: nombreUsuario,
        user_resultado: resumen,
        nombre_empresa: "CYM Consultoría RRHH"
      })
      .then(() => {
        alert("✅ Resultados DISC enviados correctamente a tu correo.");
      })
      .catch((err) => {
        console.error(err);
        alert("❌ Error al enviar el correo. Verifica tu configuración de EmailJS.");
      });
    });
  </script>
</body>
</html>
